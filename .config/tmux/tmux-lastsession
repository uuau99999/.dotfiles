#!/usr/bin/env bash

current=$(tmux display-message -p '#S')

tmux_running=$(pgrep tmux)

if [[ -z $TMUX ]] && [[ -z $tmux_running ]]; then
  echo "tmux not running"
  exit 0
fi

# 获取按最后活动时间倒序排列的 session 列表，排除当前 session，取第一个
selected=$(tmux list-sessions -F '#{session_last_attached} #{session_name}' | sort -rn | awk -v current="$current" '$2 != current {print $2; exit}')

if [[ -z $selected ]]; then
  tmux display-message "no previous session"
  exit 0
fi

tmux switch-client -t $selected
